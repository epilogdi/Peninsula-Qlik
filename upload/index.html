<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Peninsula | Sistema cargue de archivos</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
  </head>
  <body>
    <header class="bg-dark py-5">
      <div class="container px-5">
        <div class="row gx-5 justify-content-center">
          <div class="col-lg-6">
            <div class="text-center my-5">
              <img src="assets/peninsula2.png" alt="">  
              <p class="lead text-white-50 mb-4">Utilice las siguientes opciones para cargar el archivo de interés.</p>
              <div class="d-grid gap-3 d-sm-flex justify-content-sm-center">
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- Features section-->
    <section class="py-5 border-bottom" id="features">
      <div class="container px-5 my-5">
        <div class="row gx-5">
          <div class="col-lg-4 mb-5 mb-lg-0">
            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-collection"></i></div>
            <h2 class="h4 fw-bolder">XXXXX</h2>
            <p>Utilice la siguiente opción para cargar el archivo asociado a XXXXX.</p>
            <form method="post" action="" enctype="multipart/form-data" id="myform">    
              <div> 
                <input type="text" class="hide" name="idx" value="XXXXX">
                <input type="file" class="uploadFile hide" id="file" name="file" onchange="uploadFile(this)"/> 
                <input type="button" class="button uploadButton hide" value="Upload"> 
                <a class="text-decoration-none uploadLink" href="javascript:void(0)">
                  Subir archivo
                  <i class="bi bi-cloud-upload"></i>
                </a>
              </div> 
            </form>
          </div>
          <div class="col-lg-4 mb-5 mb-lg-0">
            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-building"></i></div>
            <h2 class="h4 fw-bolder">YYYYY</h2>
            <p>Utilice la siguiente opción para cargar el archivo asociado a YYYYY.</p>
            <form method="post" action="" enctype="multipart/form-data" id="myform">    
              <div> 
                <input type="text" class="hide idx" value="YYYYY">
                <input type="file" class="uploadFile hide" id="file" name="file" onchange="uploadFile(this)"/> 
                <input type="button" class="button uploadButton hide" value="Upload"> 
                <a class="text-decoration-none uploadLink" href="javascript:void(0)">
                  Subir archivo
                  <i class="bi bi-cloud-upload"></i>
                </a>
              </div> 
            </form>
          </div>
          <div class="col-lg-4">
            <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-toggles2"></i></div>
            <h2 class="h4 fw-bolder">ZZZZZ</h2>
            <p>Utilice la siguiente opción para cargar el archivo asociado a ZZZZZ.</p>
            <form method="post" action="" enctype="multipart/form-data" id="myform">    
              <div> 
                <input type="text" class="hide idx" value="ZZZZZ">
                <input type="file" class="uploadFile hide" id="file" name="file" onchange="uploadFile(this)"/> 
                <input type="button" class="button uploadButton hide" value="Upload"> 
                <a class="text-decoration-none uploadLink" href="javascript:void(0)">
                  Subir archivo
                  <i class="bi bi-cloud-upload"></i>
                </a>
              </div> 
            </form>
          </div>
        </div>
      </div>
    </section>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/scripts.js"></script>
    <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    <style>
      .hide{
        display:none
      }
    </style>
    <script>
      $(document).ready(function(){
        $(".uploadLink").click(function(){
          $(this).closest("form").find(".uploadFile").trigger("click")
        })

        $(".uploadButton").click(function() { 
          var fd = new FormData(); 
          fd = $(this).closest("form").serialize();
          var files = $('#file')[0].files[0]; 
          fd.append('file', files); 

          $.ajax({ 
            url: 'php/archivos/upload.php', 
            type: 'post', 
            data: fd, 
            contentType: false, 
            processData: false, 
            success: function(response){ 
              if(response != 0){ 
                alert('file uploaded'); 
              } 
              else{ 
                alert('file not uploaded'); 
              } 
            }, 
          }); 
        }); 
      })

      function uploadFile(esto){
        var fd = new FormData(); 
        var files = $('#file')[0].files[0]; 
        fd.append('file', files); 

        $.ajax({ 
          url: 'archivos/upload.php', 
          type: 'post', 
          data: fd, 
          contentType: false, 
          processData: false, 
          success: function(response){ 
            if(response != 0){ 
              alert('El archivo se subió correctamente'); 
            } 
            else{ 
              alert('Problemas subiendo el archivo'); 
            } 
          }, 
        });
        //$(this).closest("form").find(".uploadButton").trigger("click")
      }
    </script>
  </body>
</html>
